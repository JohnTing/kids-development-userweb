import{d as b,r as d,m as O,o as l,c as r,a as c,b as _,w as C,f as P,F as v,g as T,u as L,i as N,t as U,e as j}from"./index.2d46f6a2.js";import{P as x}from"./papaparse.min.2786dcc2.js";import"./_commonjsHelpers.4e997714.js";const M={class:"form-row"},S={class:"col-sm-8"},V={key:0},q={key:1},B=["value"],I={key:0},G=N(" Google \u5730\u5716\uFF1A "),R=["src"],Q=b({__name:"HospitalMap",setup(F){const f=window.location.search,g=new URLSearchParams(f),a=d({}),h=d(parseInt(g.get("type")+"")),n=d(""),E=d([]),k=O(()=>"https://maps.google.com/maps?q="+n.value+"&t=&z=17&ie=UTF8&iwloc=&output=embed");fetch("clinicList.csv").then(s=>s.text()).then(s=>{const e=x.parse(s).data;for(let t of e){let i={name:t[0],address:t[1],telephone:t[2]};E.value.push(i)}});const u=new Headers;u.append("X-Parse-Application-Id","kYUbkvUsiOYbHlfGTekGVCsdoLgHXglAcQbaO57f"),u.append("X-Parse-REST-API-Key","HBi7YTskQm6k7AcUFIN3Rp5sH2FMKvHbRyfEyr4Q"),u.append("Content-Type","application/json");const A={method:"GET",headers:u};function y(){fetch("https://kds.b4a.io/classes/HospitalList/",A).then(s=>s.json()).then(s=>{console.log(s.results),a.value={},s.results.map(e=>{e.type==h.value&&(delete e.createdAt,delete e.updatedAt,a.value[e.name]=e)})}).catch(s=>console.log("error",s))}y();function w(s){if(s.preventDefault(),console.log(n.value),!(n.value in a.value)){alert("\u4E0D\u5728\u9078\u9805\u5167");return}const e=a.value[n.value];if(e.number>=e.cap){alert("\u5DF2\u984D\u6EFF");return}e.number+=1;var t=JSON.stringify(e);const i={method:"PUT",headers:u,body:t};console.log(t),fetch("https://kds.b4a.io/classes/HospitalList/"+e.objectId,i).then(o=>o.json()).then(o=>{console.log(o),y()}).catch(o=>console.log(o));let p=Object.getOwnPropertyNames(a.value);p=p.filter(o=>o!=e.name);let H=p[Math.floor(Math.random()*p.length)];const m=a.value[H];m.number-=1;const D={method:"PUT",headers:u,body:JSON.stringify(m)};fetch("https://kds.b4a.io/classes/HospitalList/"+m.objectId,D).then(o=>o.json()).then(o=>{console.log(o)}).catch(o=>console.log(o))}return(s,e)=>(l(),r(v,null,[c("div",M,[c("div",S,[h.value==0?(l(),r("h2",V,"\u81FA\u4E2D\u5E02\u5152\u7AE5\u767C\u5C55\u806F\u5408\u8A55\u4F30\u4E2D\u5FC3")):_("",!0),h.value==1?(l(),r("h2",q,"\u81FA\u4E2D\u5E02\u5340\u57DF\u7D1A\u4EE5\u4E0A\u91AB\u7642\u55AE\u4F4D")):_("",!0),C(c("select",{class:"form-control",id:"clinic",name:"clinic","onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),required:""},[(l(!0),r(v,null,T(a.value,(t,i)=>(l(),r("option",{key:t.name,value:t.name},U(t.name+" ("+t.number+"/"+t.cap+")"),9,B))),128))],512),[[P,n.value]]),c("button",{type:"submit",class:"btn btn-primary",onClick:w},"\u639B\u865F")])]),n.value?(l(),r("div",I,[G,c("iframe",{src:L(k),width:"100%",height:"480",style:{border:"0"},loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,R)])):_("",!0)],64))}}),J=b({__name:"MapView",setup(F){return(f,g)=>(l(),r("main",null,[j(Q)]))}});export{J as default};
//# sourceMappingURL=MapView.cc422527.js.map
