{"version":3,"file":"KidForm.e7805d53.js","sources":["../../src/components/KidForm.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ref, type Ref } from \"vue\";\r\n\r\nimport dayjs from \"dayjs\";\r\nimport router from \"@/router\";\r\n\r\n\r\ntype monthT =\r\n  {\r\n    title: string,\r\n    special: boolean,\r\n    answer: boolean\r\n  }\r\n\r\ntype monthRootT =\r\n  {\r\n    title: string,\r\n    min: number,\r\n    max: number\r\n  }\r\n\r\nconst months: Ref<Record<string, monthRootT>> = ref({})\r\nfetch(\"monthRoot.json\").then(value => value.json()).then(value => {\r\n  months.value = value;\r\n});\r\n\r\nconst selected = ref(\"\");\r\nconst monthFrom: Ref<monthT[]> = ref([]);\r\nconst box: Ref<string[]> = ref([]);\r\n\r\nfunction updataMonth() {\r\n  box.value = [];\r\n  fetch(selected.value).then(\r\n    (value) => value.json()).then(\r\n      (value) => {\r\n        monthFrom.value = value.inspectionItems\r\n        for (let v in monthFrom.value) {\r\n          monthFrom.value[v].title = monthFrom.value[v].title.replace(/\\d+\\.(.+)/, \"$1\");\r\n        }\r\n      }\r\n    )\r\n}\r\n\r\nconst kidBirthday = ref(dayjs().format('YYYY-MM-DD'));\r\nconst diffMonth = ref(\"\");\r\nfunction calculateMonth() {\r\n  console.log(kidBirthday.value);\r\n  const diff = dayjs().diff(dayjs(kidBirthday.value));\r\n\r\n  const diffday = diff / (1000 * 60 * 60 * 24);\r\n  console.log(\"diffday = \" + diffday);\r\n  for (const i in months.value) {\r\n    if (months.value[i].min <= diffday && months.value[i].max >= diffday) {\r\n      selected.value = i;\r\n      updataMonth();\r\n    }\r\n  }\r\n  diffMonth.value = \"\" + (diffday / 30).toFixed(1) + \"月\";\r\n}\r\n\r\n\r\nconst isLoading = ref(false);\r\nfunction getFormValues(submitEvent: Event) {\r\n  submitEvent.preventDefault();\r\n  \r\n  \r\n\r\n  \r\n  const formData = new FormData(submitEvent.target as HTMLFormElement);\r\n\r\n  let data: Record<string, string> = {};\r\n  formData.forEach((v, k, a) => data[k] = v.toString())\r\n  console.log(data);\r\n  \r\n  if( Object.keys(data).length == 0) {\r\n    alert(\"請輸入資料\");\r\n    return;\r\n  }\r\n\r\n  sendFormDate(data);\r\n}\r\n\r\nfunction sendFormDate(date: Record<string, string>) {\r\n  isLoading.value = true;\r\n  \r\n  /*\r\n  const myNewObject: Parse.Object = new Parse.Object(\"KidFrom\");\r\n  for (const i in date) {\r\n    myNewObject.set(i, date[i]);\r\n  }\r\n  myNewObject.save()\r\n    .then(result => {\r\n      console.log(\"KidFrom created\", result);\r\n      router.push(\"/user\");\r\n    })\r\n    .catch(error => console.error(\"Error while creating KidFrom: \", error));\r\n  */\r\n\r\n  const myHeaders = new Headers();\r\n  myHeaders.append(\"X-Parse-Application-Id\", \"kYUbkvUsiOYbHlfGTekGVCsdoLgHXglAcQbaO57f\");\r\n  myHeaders.append(\"X-Parse-REST-API-Key\", \"HBi7YTskQm6k7AcUFIN3Rp5sH2FMKvHbRyfEyr4Q\");\r\n  myHeaders.append(\"Content-Type\", \"application/json\");\r\n\r\n  const raw = JSON.stringify(date);\r\n\r\n  const requestOptions = {\r\n    method: 'GET',\r\n    headers: myHeaders,\r\n    body: raw\r\n  };\r\n\r\n  fetch(\"https://kds.b4a.io/classes/KidFrom\", requestOptions)\r\n    .then(response => response.text())\r\n    .then(result => console.log(result))\r\n    .catch(error => console.log('error', error));\r\n\r\n \r\n}\r\n</script>\r\n\r\n<template>\r\n\r\n  <div>\r\n    <label>請選擇您的寶貝年齡進行檢測：</label>\r\n    <br>\r\n    <div class=\"form-inline\">\r\n      <input type=\"date\" class=\"form-control\" v-model=\"kidBirthday\">\r\n      <button type=\"button\" class=\"btn btn-secondary\" v-on:click=\"calculateMonth\">確定</button>\r\n    </div>\r\n    <br>\r\n    <label>試算結果：{{ diffMonth }}</label>\r\n  </div>\r\n\r\n\r\n  <pre v-if=\"selected\">\r\n    兒童符合該項目描述的現象圈選[是]，若不符合或沒有該項目描述的現象圈選[否]。\r\n    ★表示為重要檢測題目，請實地測試，再紀錄兒童反應。</pre>\r\n  <form id=\"form\" @submit.prevent=\"getFormValues\">\r\n    <select class=\"form-control\" id=\"selectDistrict\" name=\"selectDistrict\" v-on:change=\"updataMonth\" v-model=\"selected\">\r\n      <option v-for=\"(v, k, a) in months\" :value=\"k\">{{ v.title }}</option>\r\n    </select>\r\n\r\n    <table id=\"mytable\" class=\"table table-striped table-sm\">\r\n      <thead>\r\n      </thead>\r\n\r\n      <tbody>\r\n        <tr v-for=\"pair in monthFrom.map((v, i) => {\r\n          return { value: v, index: i, id: `inspectionItem_ + ${i}` };\r\n        })\" :key=\"pair.index\">\r\n\r\n          <th class=\"star\">{{ (pair.index + 1) + \".\" }}</th>\r\n          <th class=\"star\">{{ pair.value.special ? \"★\" : \"\" }}</th>\r\n          <th>{{ pair.value.title }}</th>\r\n\r\n          <th class=\"slist_radio\">\r\n            <input type=\"radio\" :id=\"pair.id + '_1'\" :name=\"'q_' + pair.index\" value=true v-model=\"box[pair.index]\" required/>\r\n            <label :for=\"pair.id + '_1'\">是</label>\r\n          </th>\r\n\r\n          <th class=\"slist_radio\">\r\n            <input type=\"radio\" :id=\"pair.id + '_0'\" :name=\"'q_' + pair.index\" value=false v-model=\"box[pair.index]\" required/>\r\n            <label :for=\"pair.id + '_0'\">否</label>\r\n          </th>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <button class=\"btn btn-primary\" type=\"submit\" :disabled=\"isLoading\">\r\n      確認\r\n      <span class=\"spinner-border spinner-border-sm\" v-if=\"isLoading\"></span>\r\n    </button>\r\n    \r\n  </form>\r\n</template>\r\n\r\n<style>\r\n.star {\r\n  width: 10px;\r\n  text-align: center;\r\n}\r\n\r\n.slist_radio {\r\n  width: min-content;\r\n}\r\n\r\n.slist_radio input[type=\"radio\"] {\r\n  position: absolute;\r\n  opacity: 0;\r\n}\r\n\r\n.slist_radio label {\r\n  text-align: center;\r\n  white-space: nowrap;\r\n  background-color: #dee2e6;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  display: block;\r\n  position: relative;\r\n  width: 2.5rem;\r\n  height: 2.5rem;\r\n  margin: 0 0rem;\r\n  line-height: 2.5rem;\r\n}\r\n\r\n.slist_radio input[type=\"radio\"]:checked+label {\r\n\r\n  -webkit-box-shadow: inset 0 0 0 2px #000000;\r\n  box-shadow: inset 0 0 0 2px #000000;\r\n}\r\n\r\n.slist_answer {\r\n  background-color: lightgray;\r\n}\r\n</style>\r\n"],"names":[],"mappings":"wuBAqBM,KAAA,GAA0C,EAAI,CAAA,CAAE,EAChD,MAAA,gBAAgB,EAAE,KAAK,AAAA,GAAS,EAAM,MAAM,EAAE,KAAK,AAAS,GAAA,CAChE,EAAO,MAAQ,CAAA,CAChB,EAEK,KAAA,GAAW,EAAI,EAAE,EACjB,EAA2B,EAAI,CAAA,CAAE,EACjC,EAAqB,EAAI,CAAA,CAAE,EAEV,YAAA,CACrB,EAAI,MAAQ,GACZ,MAAM,EAAS,KAAK,EAAE,KACpB,AAAC,GAAU,EAAM,KAAM,CAAA,EAAE,KACvB,AAAC,GAAU,CACT,EAAU,MAAQ,EAAM,gBACf,OAAA,KAAK,GAAU,MACZ,EAAA,MAAM,GAAG,MAAQ,EAAU,MAAM,GAAG,MAAM,QAAQ,YAAa,IAAI,CAC/E,CAEJ,CACJ,CAEA,KAAM,GAAc,EAAI,EAAQ,EAAA,OAAO,YAAY,CAAC,EAC9C,EAAY,EAAI,EAAE,EACE,YAAA,CAChB,QAAA,IAAI,EAAY,KAAK,EAG7B,KAAM,GAAU,AAFH,IAAQ,KAAK,EAAM,EAAY,KAAK,CAAC,EAEnB,KAAA,GAAK,GAAK,IACjC,QAAA,IAAI,aAAe,CAAO,EACvB,SAAA,KAAK,GAAO,MACjB,AAAA,EAAO,MAAM,GAAG,KAAO,GAAW,EAAO,MAAM,GAAG,KAAO,GAC3D,GAAS,MAAQ,EACL,KAGhB,EAAU,MAAQ,GAAM,GAAU,IAAI,QAAQ,CAAC,EAAI,QACrD,CAGM,KAAA,GAAY,EAAI,EAAK,EAC3B,WAAuB,EAAoB,CACzC,EAAY,eAAe,EAK3B,KAAM,GAAW,GAAI,UAAS,EAAY,MAAyB,EAEnE,GAAI,GAA+B,CAAA,EAInC,GAHS,EAAA,QAAQ,CAAC,EAAG,EAAG,IAAM,EAAK,GAAK,EAAE,SAAU,CAAA,EACpD,QAAQ,IAAI,CAAI,EAEZ,OAAO,KAAK,CAAI,EAAE,QAAU,EAAG,CACjC,MAAM,gCAAO,EACb,MACF,CAEA,EAAa,CAAI,CACnB,CAEA,WAAsB,EAA8B,CAClD,EAAU,MAAQ,GAeZ,KAAA,GAAY,GAAI,SACZ,EAAA,OAAO,yBAA0B,0CAA0C,EAC3E,EAAA,OAAO,uBAAwB,0CAA0C,EACzE,EAAA,OAAO,eAAgB,kBAAkB,EAE7C,KAAA,GAAM,KAAK,UAAU,CAAI,EAQzB,MAAA,qCANiB,CACrB,OAAQ,MACR,QAAS,EACT,KAAM,CAAA,CAGkD,EACvD,KAAK,GAAY,EAAS,KAAA,CAAM,EAChC,KAAK,AAAA,GAAU,QAAQ,IAAI,CAAM,CAAC,EAClC,MAAM,GAAS,QAAQ,IAAI,QAAS,CAAK,CAAC,CAG/C;"}